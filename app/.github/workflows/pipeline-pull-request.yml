name: PR Pipeline

on:
  pull_request:

jobs:
  linters:
    uses: ./.github/workflows/linters.yml

  unit-tests:
    uses: ./.github/workflows/unit_tests.yml

  e2e-tests:
    uses: ./.github/workflows/e2e_tests.yml
    secrets:
      GCP_SA_KEY: ${{ secrets.GCP_SA_KEY }}
    permissions:
      contents: read # Required to checkout
      id-token: write # Required to get token for GCP

  build-and-preview:
    needs: [linters, unit-tests, e2e-tests]
    uses: ./.github/workflows/firebase-hosting-pull-request.yml
    secrets:
      GCP_SA_KEY: ${{ secrets.GCP_SA_KEY }}
    permissions:
      contents: read
      id-token: write
      checks: write # Generated by firebase in the pre-filled workflow: reason unclear
      pull-requests: write # Required for firebase to comment on a PR
